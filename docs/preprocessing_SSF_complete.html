<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SSF â€“ How does human activity affect the movement patterns of wild animals?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="custom.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SSF</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0. Setup ----------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  tidyverse,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  amt,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  sf,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  geosphere,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  terra,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  MASS,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  glmmTMB,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  emmeans,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  paletteer,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  gratia,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  ggridges,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  performance</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set options</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>) <span class="co"># Turn off scientific notation</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">15</span>) <span class="co"># Set digits to 15 to ensure GPS coordinates aren't truncated</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">2</span> <span class="co"># Set number of threads for modelling</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Define common plot theme</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>theme_publication_dark <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">14</span>, <span class="at">legend_position =</span> <span class="st">"bottom"</span>) {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> legend_position,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#222222"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background  =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#222222"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#424242"</span>), </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#222222"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#222222"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">15</span>)),</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">15</span>)),</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="at">unit =</span> <span class="st">"pt"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Define color palette</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>landuse_colors <span class="ot">&lt;-</span> <span class="fu">paletteer_d</span>(<span class="st">"nationalparkcolors::Badlands"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Water"</span>, <span class="st">"Cropland"</span>, <span class="st">"BuiltUp"</span>, <span class="st">"TreeCover"</span>, <span class="st">"Open"</span>))</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Data Preparation -----------------------------------------------------</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.1 Load, visualize and filter raw tracking data ------------------------</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>tracking_data <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"data/bobcat_coyotes_wa_gps.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">long =</span> <span class="st">`</span><span class="at">location-long</span><span class="st">`</span>, </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="st">`</span><span class="at">location-lat</span><span class="st">`</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">`</span><span class="at">individual-local-identifier</span><span class="st">`</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">timestamp =</span> <span class="st">`</span><span class="at">timestamp</span><span class="st">`</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">species =</span> <span class="st">`</span><span class="at">individual-taxon-canonical-name</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(id, timestamp) <span class="sc">|&gt;</span> </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, species, timestamp, lat, long) <span class="sc">|&gt;</span> </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out MVBOB71M after dispersal</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(id <span class="sc">==</span> <span class="st">"MVBOB71M"</span> <span class="sc">&amp;</span> timestamp <span class="sc">&gt;</span> <span class="fu">as.POSIXct</span>(<span class="st">"2019-09-24 00:00:00"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 121706 Columns: 15
â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Delimiter: ","
chr  (7): gps:fix-type-raw, mortality-status, sensor-type, individual-taxon-...
dbl  (6): event-id, location-long, location-lat, gps:hdop, gps:satellite-cou...
lgl  (1): visible
dttm (1): timestamp

â„¹ Use `spec()` to retrieve the full column specification for this data.
â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.2 Create amt tracks ---------------------------------------------------</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>track <span class="ot">&lt;-</span> tracking_data <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>species)) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trk =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">make_track</span>(.x, long, lat, timestamp, <span class="at">crs =</span> <span class="dv">4326</span>)))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize sampling rate</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>trackSummary <span class="ot">&lt;-</span> track <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sr =</span> <span class="fu">lapply</span>(trk, summarize_sampling_rate, <span class="at">time_unit =</span> <span class="st">"hour"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, sr) <span class="sc">|&gt;</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> sr) <span class="sc">|&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">distinct</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(tracking_data, id, species))) <span class="sc">|&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species, median)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trackSummary, <span class="at">n =</span> <span class="dv">70</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 70 Ã— 11
   id          min    q1 median  mean    q3   max     sd     n unit  species    
   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      
 1 MVCOY100F 3.98    4     4     4.16  4     12    0.855   634 hour  Canis latrâ€¦
 2 MVCOY18F  3.93    4     4     4.56  4     68    2.70   2383 hour  Canis latrâ€¦
 3 MVCOY56M  3.98    4     4     4.11  4     12    0.739  1291 hour  Canis latrâ€¦
 4 MVCOY58M  3.97    4     4     4.22  4     20    1.15   3596 hour  Canis latrâ€¦
 5 MVCOY59F  3.95    4     4     4.24  4     20    1.22   1217 hour  Canis latrâ€¦
 6 MVCOY60M  3.93    4     4     4.61  4     60    2.46   2956 hour  Canis latrâ€¦
 7 MVCOY63M  3.95    4     4     4.32  4     24    1.57   3615 hour  Canis latrâ€¦
 8 MVCOY68F  3.93    4     4     4.56  4    316    5.74   6882 hour  Canis latrâ€¦
 9 MVCOY72F  3.98    4     4     4.91  4     16    2.14     75 hour  Canis latrâ€¦
10 MVCOY73M  3.95    4     4     4.59  4    160    3.51   2737 hour  Canis latrâ€¦
11 MVCOY74M  3.97    4     4     4.64  4     28    2.09    793 hour  Canis latrâ€¦
12 MVCOY79F  3.93    4     4     4.31  4     36    1.61   3625 hour  Canis latrâ€¦
13 MVCOY81M  3.93    4     4     4.33  4     20    1.47   2963 hour  Canis latrâ€¦
14 MVCOY82M  3.93    4     4     4.64  4     40    2.19   1349 hour  Canis latrâ€¦
15 MVCOY92M  3.97    4     4     4.27  4     40    1.67   1426 hour  Canis latrâ€¦
16 MVCOY97M  3.95    4     4     4.60  4     16    1.72    731 hour  Canis latrâ€¦
17 MVCOY98M  3.95    4     4     4.44  4     16    1.52   1512 hour  Canis latrâ€¦
18 NECOY14M  3.93    4     4     4.40  4     12    1.47     91 hour  Canis latrâ€¦
19 NECOY17M  3.97    4     4     4.09  4     12    0.602  1989 hour  Canis latrâ€¦
20 NECOY1F   1.32    4     4     4.44  4     48    2.08   2917 hour  Canis latrâ€¦
21 NECOY20F  3.97    4     4     4.43  4     48    2.11   1483 hour  Canis latrâ€¦
22 NECOY21F  3.93    4     4     4.62  4     76    2.47   3470 hour  Canis latrâ€¦
23 NECOY29M  3.93    4     4     4.98  4    192    5.03   1905 hour  Canis latrâ€¦
24 NECOY2M   0.483   4     4     4.11  4     16    0.768  3974 hour  Canis latrâ€¦
25 NECOY31M  3.95    4     4     4.71  4     16    2.04    564 hour  Canis latrâ€¦
26 NECOY36M  3.95    4     4     4.15  4     16    0.869  3254 hour  Canis latrâ€¦
27 NECOY3F   3.95    4     4     4.60  4     40    2.02   2954 hour  Canis latrâ€¦
28 NECOY42F  3.97    4     4     6.13  8     24    3.79    158 hour  Canis latrâ€¦
29 NECOY43F  1.83    4     4     7.40  8     76    5.37   2083 hour  Canis latrâ€¦
30 NECOY44M  3.93    4     4     4.89  4     68    2.55   3694 hour  Canis latrâ€¦
31 NECOY4M   3.95    4     4     4.30  4     24    1.40   3417 hour  Canis latrâ€¦
32 NECOYaF   3.95    4     4     4.28  4     24    1.51   2769 hour  Canis latrâ€¦
33 MVCOY65M  4      12    24    43.4  60    172.  43.5     242 hour  Canis latrâ€¦
34 NECOY12F  3.98   20.0  24    46.9  48    344.  51.4     110 hour  Canis latrâ€¦
35 MVBOB51M  3.93    4     4     7.57  8     56    5.94   1259 hour  Lynx rufus 
36 MVBOB52M  3.93    4     4     5.87  8     44    3.94   2214 hour  Lynx rufus 
37 MVBOB54F  3.95    4     4     5.12  4     76    3.83    997 hour  Lynx rufus 
38 MVBOB55M  3.93    4     4     9.11 12    108    8.94    950 hour  Lynx rufus 
39 MVBOB62M  3.93    4     4     4.68  4     68    2.80   1746 hour  Lynx rufus 
40 MVBOB66M  3.93    4     4     5.04  4     48    2.66   3000 hour  Lynx rufus 
41 MVBOB67M  2.62    4     4     6.42  8     94.8  4.99   2209 hour  Lynx rufus 
42 MVBOB69F  2.6     4     4     8.53 12    132    7.78   1575 hour  Lynx rufus 
43 MVBOB71M  3.97    4     4     5.12  4     28.0  2.75   1932 hour  Lynx rufus 
44 MVBOB85F  3.93    4     4     5.29  4     52    4.02   1526 hour  Lynx rufus 
45 MVBOB90M  3.93    4     4     5.05  4     44    3.00   1041 hour  Lynx rufus 
46 MVBOB99F  3.93    4     4     7.56  8     84    6.86    372 hour  Lynx rufus 
47 NEBOB13F  3.33    4     4     7.63  8    152.   7.39   1722 hour  Lynx rufus 
48 NEBOB35M  3.93    4     4     5.04  4     36    2.51   1589 hour  Lynx rufus 
49 NEBOB38M  2.22    4     4     5.18  4     32.0  2.91   2442 hour  Lynx rufus 
50 NEBOB41F  3.93    4     4    12.8   9.03 908   43.9     988 hour  Lynx rufus 
51 NEBOB45M  3.03    4     4     4.82  4     28    2.31   1606 hour  Lynx rufus 
52 NEBOB5M   3.95    4     4     7.47  8     72    6.27    832 hour  Lynx rufus 
53 NEBOB6F   3.93    4     4     4.91  4     44    2.87   2552 hour  Lynx rufus 
54 NEBOB7F   0.467   4     4     5.08  4.02 104.   4.18   2629 hour  Lynx rufus 
55 NEBOB32F  2.27    4     4.05  8.49 11.9  104.   7.42   1176 hour  Lynx rufus 
56 MVBOB83M  3.08    4     4.07  8.89 12    120    7.86   1592 hour  Lynx rufus 
57 MVBOB76M  2.8     4     7.95  8.62 12    100    7.15   1647 hour  Lynx rufus 
58 MVBOB77M  3.93    4     8    12.7  16    268   15.4    1045 hour  Lynx rufus 
59 MVBOB80M  3.93    4     8     9.81 12    196   12.1    1423 hour  Lynx rufus 
60 NEBOB10F  3.93    4     8    11.1  12    272   16.6    1222 hour  Lynx rufus 
61 NEBOB11M  4       4     8    11.7  18     48   11.1      27 hour  Lynx rufus 
62 NEBOB16M  3.93    4     8     8.50 12     84    6.76   1273 hour  Lynx rufus 
63 NEBOB23M  3.93    4     8     9.95 12    308   13.1    1395 hour  Lynx rufus 
64 NEBOB25F  3.93    4     8     9.47 12    100    8.23   1515 hour  Lynx rufus 
65 NEBOB33M  1.72    4     8    14.2  16    544   30.2     929 hour  Lynx rufus 
66 NEBOB37M  3.93    4     8    11.2  12    104   11.5     655 hour  Lynx rufus 
67 MVBOB91M  4       4    12    11.7  18     24    7.48     15 hour  Lynx rufus 
68 NEBOB8M   3.93    4    12    17.2  20    268   21.9     383 hour  Lynx rufus 
69 MVBOB88M  3.93    8    16    22.4  28.0  172.  24.1     554 hour  Lynx rufus 
70 MVBOB87M  3.95   16.0  40    53.8  71.0  336   54.6     126 hour  Lynx rufus </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the individual sampling rates, for plotting</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>trackSummarySamples <span class="ot">&lt;-</span> track <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sr =</span> <span class="fu">lapply</span>(trk, summarize_sampling_rate, <span class="at">time_unit =</span> <span class="st">"hour"</span>, <span class="at">summarize =</span> <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(id, sr) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> sr) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"BOB"</span>, id), <span class="st">"Bobcat"</span>, <span class="st">"Coyote"</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trackSummarySamples,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> sr,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill  =</span> species, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_boxplot</span>(<span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values  =</span> <span class="fu">c</span>(<span class="at">Bobcat =</span> <span class="st">"#723735"</span>)) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Bobcat =</span> <span class="st">"#DB4743FF"</span>,  <span class="at">Coyote =</span> <span class="st">"#5495CFFF"</span>)) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sampling interval in hours"</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>() <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#GPS sampling interval by species (outliers hidden)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"img/bobcat_coyote_sampling_rates.png"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trackSummarySamples,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> sr,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill  =</span> species,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> species)) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span>                   </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Bobcat =</span> <span class="st">"#DB4743FF"</span>,  <span class="at">Coyote =</span> <span class="st">"#5495CFFF"</span>)) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sampling interval in hours"</span>) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#GPS sampling interval by species (outliers shown)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"img/bobcat_coyote_sampling_rates_outliers.png"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Split into species</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>coyote <span class="ot">&lt;-</span> <span class="fu">filter</span>(track, <span class="fu">grepl</span>(<span class="st">"COY"</span>, id))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>bobcat <span class="ot">&lt;-</span> <span class="fu">filter</span>(track, <span class="fu">grepl</span>(<span class="st">"BOB"</span>, id))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.3 Resample tracks and generate steps ----------------------------------</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Omitting coyote in row 8 and 19; too few consecutive data points - causing function to fail</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>coyote1 <span class="ot">&lt;-</span> coyote[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">19</span>), ] <span class="sc">|&gt;</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stp =</span> <span class="fu">map</span>(trk, <span class="cf">function</span>(df)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">track_resample</span>(<span class="at">rate =</span> <span class="fu">hours</span>(<span class="dv">4</span>), <span class="at">tolerance =</span> <span class="fu">minutes</span>(<span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">steps_by_burst</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">random_steps</span>(<span class="at">n_control =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">log_sl_ =</span> <span class="fu">log</span>(sl_ <span class="sc">+</span> <span class="dv">1</span>), <span class="at">cos_ta_ =</span> <span class="fu">cos</span>(ta_)))) <span class="sc">|&gt;</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data, <span class="sc">-</span>trk) <span class="sc">|&gt;</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> stp) <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case_binary_ =</span> <span class="fu">ifelse</span>(case_ <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 181 warnings in `mutate()`.
The first warning was:
â„¹ In argument: `stp = map(...)`.
Caused by warning in `random_steps.bursted_steps_xyt()`:
! Some bursts contain &lt; 3 steps and will be removed
â„¹ Run `dplyr::last_dplyr_warnings()` to see the 180 remaining warnings.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Omitting bobcat in row 15 and 18; too few consecutive data points - causing function to fail</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>bobcat1 <span class="ot">&lt;-</span> bobcat[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">18</span>), ] <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stp =</span> <span class="fu">map</span>(trk, <span class="cf">function</span>(df)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">track_resample</span>(<span class="at">rate =</span> <span class="fu">hours</span>(<span class="dv">8</span>), <span class="at">tolerance =</span> <span class="fu">minutes</span>(<span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">steps_by_burst</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">random_steps</span>(<span class="at">n_control =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">log_sl_ =</span> <span class="fu">log</span>(sl_ <span class="sc">+</span> <span class="dv">1</span>), <span class="at">cos_ta_ =</span> <span class="fu">cos</span>(ta_)))) <span class="sc">|&gt;</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data, <span class="sc">-</span>trk) <span class="sc">|&gt;</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> stp) <span class="sc">|&gt;</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case_binary_ =</span> <span class="fu">ifelse</span>(case_ <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 240 warnings in `mutate()`.
The first warning was:
â„¹ In argument: `stp = map(...)`.
Caused by warning in `random_steps.bursted_steps_xyt()`:
! Some bursts contain &lt; 3 steps and will be removed
â„¹ Run `dplyr::last_dplyr_warnings()` to see the 239 remaining warnings.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save resampled step data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(coyote1, <span class="st">"data/coyote_resampled.rds"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(bobcat1,  <span class="st">"data/bobcat_resampled.rds"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to recalculate step lengths (in meters)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>recalc_steps <span class="ot">&lt;-</span> <span class="cf">function</span>(file) {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(file) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>log_sl_, <span class="sc">-</span>sl_) <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sl_ =</span> <span class="fu">distGeo</span>(<span class="fu">across</span>(<span class="fu">c</span>(x1_, y1_)), <span class="fu">across</span>(<span class="fu">c</span>(x2_, y2_))),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">log_sl_ =</span> <span class="fu">log</span>(sl_)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to saved data</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>coyote_resampled <span class="ot">&lt;-</span> <span class="fu">recalc_steps</span>(<span class="st">"data/coyote_resampled.rds"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>bobcat_resampled <span class="ot">&lt;-</span> <span class="fu">recalc_steps</span>(<span class="st">"data/bobcat_resampled.rds"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.4 Load covariates, extract to steps -----------------------------------</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare rasters</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>hfp <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/HFP_washington.tif"</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="fu">NAflag</span>(hfp) <span class="ot">&lt;-</span> <span class="dv">64536</span>  <span class="co"># Set no-data value</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>hfp_capped <span class="ot">&lt;-</span> <span class="fu">classify</span>(hfp, <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">50000</span>, <span class="cn">Inf</span>, <span class="dv">50000</span>), <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)) <span class="co"># Cap at 50k</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>hfp_scaled <span class="ot">&lt;-</span> hfp_capped<span class="sc">/</span><span class="dv">1000</span> <span class="co"># Scale to 0-50</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>land_use <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/ESA_washington.tif"</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Land use class labels (ESA WorldCover 2021)</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>esa_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"Tree cover"</span>, <span class="st">"20"</span> <span class="ot">=</span> <span class="st">"Shrubland"</span>, <span class="st">"30"</span> <span class="ot">=</span> <span class="st">"Grassland"</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"40"</span> <span class="ot">=</span> <span class="st">"Cropland"</span>, <span class="st">"50"</span> <span class="ot">=</span> <span class="st">"Built-up"</span>, <span class="st">"60"</span> <span class="ot">=</span> <span class="st">"Bare or sparse vegetation"</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"70"</span> <span class="ot">=</span> <span class="st">"Snow and ice"</span>, <span class="st">"80"</span> <span class="ot">=</span> <span class="st">"Permanent water bodies"</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"90"</span> <span class="ot">=</span> <span class="st">"Herbaceous wetland"</span>, <span class="st">"95"</span> <span class="ot">=</span> <span class="st">"Mangroves"</span>, <span class="st">"100"</span> <span class="ot">=</span> <span class="st">"Moss and lichen"</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract covariates</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>extract_covariates <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">human_footprint =</span> terra<span class="sc">::</span><span class="fu">extract</span>(hfp_scaled, <span class="fu">cbind</span>(x2_, y2_))[, <span class="dv">1</span>],</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">land_use_code =</span> terra<span class="sc">::</span><span class="fu">extract</span>(land_use, <span class="fu">cbind</span>(x2_, y2_))[, <span class="dv">1</span>],</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">land_use =</span> <span class="fu">factor</span>(land_use_code, <span class="at">levels =</span> <span class="fu">names</span>(esa_labels), <span class="at">labels =</span> esa_labels)</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply extraction to step data</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>coyote_cov <span class="ot">&lt;-</span> <span class="fu">extract_covariates</span>(coyote_resampled)</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>bobcat_cov <span class="ot">&lt;-</span> <span class="fu">extract_covariates</span>(bobcat_resampled)</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.5 Finalize SSF dataset ------------------------------------------------</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to format for SSF</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>prepare_ssf_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">|&gt;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">land_use =</span> <span class="fu">as.factor</span>(land_use),</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Group detailed land use categories into broader, ecologically meaningful classes</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">land_use_grouped =</span> <span class="fu">fct_collapse</span>(</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        land_use, </span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">"TreeCover"</span> <span class="ot">=</span> <span class="st">"Tree cover"</span>,</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Open"</span>      <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Grassland"</span>, <span class="st">"Bare or sparse vegetation"</span>, <span class="st">"Moss and lichen"</span>),</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Cropland"</span>  <span class="ot">=</span> <span class="st">"Cropland"</span>,</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">"BuiltUp"</span>   <span class="ot">=</span> <span class="st">"Built-up"</span>,</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Water"</span>     <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Permanent water bodies"</span>, <span class="st">"Herbaceous wetland"</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create unique stratum ID (animal ID + step ID) for conditional logistic model</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>      <span class="at">step_id_ =</span> <span class="fu">paste</span>(id, step_id_, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">11</span>) <span class="sc">|&gt;</span> <span class="co"># Calculate number of steps (1 used + 10 available per stratum)</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Applying to data</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>coyote_final <span class="ot">&lt;-</span> <span class="fu">prepare_ssf_data</span>(coyote_cov)</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>bobcat_final <span class="ot">&lt;-</span> <span class="fu">prepare_ssf_data</span>(bobcat_cov)</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of bobcat SSF data revealed too few relocations in key habitat types</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="co"># and inconsistent sampling intervals compared to coyotes.</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore, bobcats are excluded from further SSF modeling.</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Save processed data</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(coyote_final, <span class="st">"data/coyote_ssf_data.rds"</span>)</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(bobcat_final, <span class="st">"data/bobcat_ssf_data.rds"</span>)</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Exploratory Data Analysis --------------------------------------------</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Read processed data</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>coyote_ssf_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/coyote_ssf_data.rds"</span>)</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Set secondary colors</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>landuse_colors_sec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TreeCover"</span> <span class="ot">=</span> <span class="st">"#4c5133"</span>,</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Open"</span>      <span class="ot">=</span> <span class="st">"#807c70"</span>, </span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Cropland"</span>  <span class="ot">=</span> <span class="st">"#7d6139"</span>,</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"BuiltUp"</span>   <span class="ot">=</span> <span class="st">"#723735"</span>, </span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Water"</span>     <span class="ot">=</span> <span class="st">"#3c566e"</span>)</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.1 Ridgeline plot (HFP across land cover classes) ----------------------</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coyote_ssf_data,</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> human_footprint, <span class="at">y =</span> <span class="fu">fct_rev</span>(land_use_grouped),</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> land_use_grouped, <span class="at">color =</span> land_use_grouped)) <span class="sc">+</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>(<span class="at">scale =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> landuse_colors_sec) <span class="sc">+</span> </span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> landuse_colors) <span class="sc">+</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Human footprint index (0â€“50)"</span>, <span class="at">y =</span> <span class="st">"Land cover type"</span>) <span class="sc">+</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.417</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Human Footprint Distribution by Land Cover Type</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"img/coyote_EDA_ridgeline.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">5.5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.417</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.2 Boxplot (HFP across land cover classes) -----------------------------</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coyote_ssf_data,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> land_use_grouped, <span class="at">y =</span> human_footprint,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> land_use_grouped, <span class="at">color =</span> land_use_grouped)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_boxplot</span>(<span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.alpha =</span> <span class="fl">0.15</span>, <span class="at">outlier.size =</span> <span class="fl">0.5</span>, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> landuse_colors_sec) <span class="sc">+</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> landuse_colors) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Land cover type"</span>, <span class="at">y =</span> <span class="st">"Human footprint index (0â€“50)"</span>) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Variation in Human Footprint across Land Cover Types</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"img/coyote_EDA_boxplot.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">5.5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.3 Bi-variate density plot (HFP vs. log step length) -------------------</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>dens <span class="ot">&lt;-</span> <span class="fu">kde2d</span>(coyote_ssf_data<span class="sc">$</span>human_footprint, coyote_ssf_data<span class="sc">$</span>log_sl_, <span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>contour_level <span class="ot">&lt;-</span> <span class="fu">quantile</span>(dens<span class="sc">$</span>z, <span class="at">probs =</span> <span class="fl">0.95</span>)  <span class="co"># Get 95% density threshold</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coyote_ssf_data, <span class="fu">aes</span>(<span class="at">x =</span> human_footprint, <span class="at">y =</span> log_sl_)) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_stat</span>(<span class="fu">log</span>(density))), <span class="at">bins =</span> <span class="dv">70</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"D"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">14.9</span>, <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"gray80"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"gray80"</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">after_stat</span>(level)), <span class="at">breaks =</span> contour_level,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">h =</span> <span class="dv">2</span>, <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Human footprint index (0â€“50)"</span>, <span class="at">y =</span> <span class="st">"Log step length"</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Relationship between Movement and Human Footprint</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"img/coyote_EDA_hexbin.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Coyote SSF Modeling --------------------------------------------------</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read SSF ready data and filter</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>coyote_ssf_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/coyote_ssf_data.rds"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="co"># Select animals with more than 100 fixes</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize HFP for modeling</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>coyote_ssf_data<span class="sc">$</span>hfp_std <span class="ot">&lt;-</span> <span class="fu">scale</span>(coyote_ssf_data<span class="sc">$</span>human_footprint)[, <span class="dv">1</span>]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.1 Fit the model -------------------------------------------------------</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit SSF with glmmTMB following Muff et al. (2019)</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>ssf_coyote <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  case_binary_ <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    land_use_grouped <span class="sc">*</span> (hfp_std <span class="sc">+</span> <span class="fu">I</span>(hfp_std<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    log_sl_ <span class="sc">+</span> </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span> <span class="sc">+</span> land_use_grouped <span class="sc">+</span> hfp_std <span class="sc">+</span> <span class="fu">I</span>(hfp_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> log_sl_<span class="sc">||</span> id) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> step_id_),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">doFit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> coyote_ssf_data,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">map =</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="cn">NA</span>))),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> <span class="dv">8</span>),<span class="fu">log</span>(<span class="fl">1e3</span>))),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmmTMBControl</span>(<span class="at">parallel =</span> nt)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.2 Save fitted model ---------------------------------------------------</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ssf_coyote, <span class="at">file =</span> <span class="st">"models/ssf_coyote_model.rds"</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>ssf_coyote <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"models/ssf_coyote_model.rds"</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3 Summarize / check model ---------------------------------------------</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model summary (fixed effects, random effects, fit statistics)</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ssf_coyote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson  ( log )
Formula:          
case_binary_ ~ -1 + land_use_grouped * (hfp_std + I(hfp_std^2)) +  
    log_sl_ + (0 + land_use_grouped + hfp_std + I(hfp_std^2) +  
    log_sl_ || id) + (1 | step_id_)
Data: coyote_ssf_data

      AIC       BIC    logLik -2*log(L)  df.resid 
1244867.3 1245141.1 -622409.6 1244819.3    666224 

Random effects:

Conditional model:
 Groups   Name                      Variance                     
 id       land_use_groupedTreeCover       0.055569998248869663382
          land_use_groupedOpen            0.000001026267180479060
          land_use_groupedCropland        0.092887072052416586043
          land_use_groupedBuiltUp         0.291697185308862738662
          land_use_groupedWater           0.000000000073816844615
          hfp_std                         0.133991081290897179334
          I(hfp_std^2)                    0.045568557037963267065
          log_sl_                         0.000162818311340898577
 step_id_ (Intercept)                999999.999999999534338712692
 Std.Dev.               Corr                                               
    0.23573289598371641                                                    
    0.00101304845909713 0.0000000000                                       
    0.30477380473462051 0.0000000000 0.0000000000                          
    0.54008997890061128 0.0000000000 0.0000000000 0.0000000000             
    0.00000859167298115 0.0000000000 0.0000000000 0.0000000000 0.0000000000
    0.36604792212345255 0.0000000000 0.0000000000 0.0000000000 0.0000000000
    0.21346792976455098 0.0000000000 0.0000000000 0.0000000000 0.0000000000
    0.01276002787382922 0.0000000000 0.0000000000 0.0000000000 0.0000000000
  999.99999999999977263                                                    
                                        
                                        
                                        
                                        
                                        
                                        
 0.0000000000                           
 0.0000000000 0.0000000000              
 0.0000000000 0.0000000000 0.0000000000 
                                        
Number of obs: 666248, groups:  id, 29; step_id_, 60568

Conditional model:
                                               Estimate        Std. Error
land_use_groupedTreeCover             -3.07415237263530  4.06357353906574
land_use_groupedOpen                  -2.79647615761533  4.06333210682469
land_use_groupedCropland              -2.81931195637970  4.06476791135366
land_use_groupedBuiltUp               -3.51586768431280  4.07061289162120
land_use_groupedWater                 -3.97072475008586  4.06726356134943
hfp_std                                0.26364575880263  0.06987204820331
I(hfp_std^2)                          -0.18623510016481  0.04184690448278
log_sl_                                0.00762730782932  0.00350259889805
land_use_groupedOpen:hfp_std          -0.12437566061456  0.01375973081389
land_use_groupedCropland:hfp_std      -0.30262763397863  0.09314011859347
land_use_groupedBuiltUp:hfp_std       -0.26818040273319  0.29901482998733
land_use_groupedWater:hfp_std         -0.72006498135142  0.23621406872803
land_use_groupedOpen:I(hfp_std^2)      0.00189272090425  0.00563742378047
land_use_groupedCropland:I(hfp_std^2)  0.02483888060471  0.02441783916909
land_use_groupedBuiltUp:I(hfp_std^2)   0.01714227509713  0.06724878760432
land_use_groupedWater:I(hfp_std^2)     0.14380651822655  0.05644843084569
                                       z value               Pr(&gt;|z|)    
land_use_groupedTreeCover             -0.75651             0.44934077    
land_use_groupedOpen                  -0.68822             0.49131274    
land_use_groupedCropland              -0.69360             0.48793480    
land_use_groupedBuiltUp               -0.86372             0.38774201    
land_use_groupedWater                 -0.97626             0.32893344    
hfp_std                                3.77327             0.00016112 ***
I(hfp_std^2)                          -4.45039           0.0000085714 ***
log_sl_                                2.17761             0.02943480 *  
land_use_groupedOpen:hfp_std          -9.03911 &lt; 0.000000000000000222 ***
land_use_groupedCropland:hfp_std      -3.24917             0.00115744 ** 
land_use_groupedBuiltUp:hfp_std       -0.89688             0.36978299    
land_use_groupedWater:hfp_std         -3.04836             0.00230096 ** 
land_use_groupedOpen:I(hfp_std^2)      0.33574             0.73706530    
land_use_groupedCropland:I(hfp_std^2)  1.01724             0.30903775    
land_use_groupedBuiltUp:I(hfp_std^2)   0.25491             0.79879391    
land_use_groupedWater:I(hfp_std^2)     2.54757             0.01084750 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate marginal trends (linear + quadratic) of HFP across land use types</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">emtrends</span>(ssf_coyote, <span class="sc">~</span> land_use_grouped, <span class="at">var =</span> <span class="st">"hfp_std"</span>, <span class="at">max.degree =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="at">infer =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>degree = linear:
 land_use_grouped hfp_std.trend     SE  df asymp.LCL asymp.UCL z.ratio p.value
 TreeCover              0.26595 0.0699 Inf   0.12903    0.4029   3.807  0.0001
 Open                   0.14155 0.0701 Inf   0.00413    0.2790   2.019  0.0435
 Cropland              -0.03698 0.1150 Inf  -0.26270    0.1887  -0.321  0.7481
 BuiltUp               -0.00244 0.3070 Inf  -0.60481    0.5999  -0.008  0.9937
 Water                 -0.45589 0.2460 Inf  -0.93880    0.0270  -1.850  0.0643

degree = quadratic:
 land_use_grouped hfp_std.trend     SE  df asymp.LCL asymp.UCL z.ratio p.value
 TreeCover             -0.18624 0.0418 Inf  -0.26825   -0.1042  -4.450  &lt;.0001
 Open                  -0.18434 0.0419 Inf  -0.26638   -0.1023  -4.404  &lt;.0001
 Cropland              -0.16140 0.0482 Inf  -0.25590   -0.0669  -3.347  0.0008
 BuiltUp               -0.16909 0.0790 Inf  -0.32398   -0.0142  -2.140  0.0324
 Water                 -0.04243 0.0700 Inf  -0.17967    0.0948  -0.606  0.5446

Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for overdispersion </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_overdispersion</span>(ssf_coyote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Overdispersion test

       dispersion ratio =      0.908
  Pearson's Chi-Squared = 604911.890
                p-value =          1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>No overdispersion detected.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIFs</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_collinearity</span>(ssf_coyote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Model has no intercept. VIFs may not be sensible.
Model has interaction terms. VIFs might be inflated.
  Try to center the variables used for the interaction, or check
  multicollinearity among predictors of a model without interaction terms.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

             Term  VIF       VIF 95% CI Increased SE Tolerance Tolerance 95% CI
 land_use_grouped 3.94 [  3.92,   3.95]         1.98      0.25     [0.25, 0.26]
          hfp_std 1.01 [  1.01,   1.01]         1.00      0.99     [0.99, 0.99]
     I(hfp_std^2) 1.01 [  1.00,   1.01]         1.00      0.99     [0.99, 1.00]
          log_sl_ 1.00 [  1.00,   1.12]         1.00      1.00     [0.89, 1.00]

High Correlation

                          Term    VIF       VIF 95% CI Increased SE Tolerance
      land_use_grouped:hfp_std 311.45 [309.97, 312.95]        17.65  3.21e-03
 land_use_grouped:I(hfp_std^2) 159.97 [159.21, 160.74]        12.65  6.25e-03
 Tolerance 95% CI
     [0.00, 0.00]
     [0.01, 0.01]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot predicted vs. observed use</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>coyote_ssf_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(ssf_coyote, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coyote_ssf_data, <span class="fu">aes</span>(<span class="at">x =</span> predicted, <span class="at">fill =</span> <span class="fu">as.factor</span>(case_binary_), <span class="at">color =</span> <span class="fu">as.factor</span>(case_binary_))) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#DB4743FF"</span>, <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"#FEF4D5FF"</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Step type"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Used"</span>, <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Available"</span>)) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#DB4743FF"</span>, <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"#FEF4D5FF"</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Step type"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Used"</span>, <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Available"</span>)) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predicted relative use (exp(Î·))"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"img/coyote_predicted_vs_used.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">5.5</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Bobcat SSF Modeling --------------------------------------------------</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read SSF ready data and filter</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>bobcat_ssf_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/bobcat_ssf_data.rds"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="co"># Select animals with more than 100 fixes</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize HFP for modeling</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>bobcat_ssf_data<span class="sc">$</span>hfp_std <span class="ot">&lt;-</span> <span class="fu">scale</span>(bobcat_ssf_data<span class="sc">$</span>human_footprint)[, <span class="dv">1</span>]</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Counts of used (1) vs. available (0) per land use category</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">case =</span> bobcat_ssf_data<span class="sc">$</span>case_binary_, </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">land_use =</span> bobcat_ssf_data<span class="sc">$</span>land_use_grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    land_use
case TreeCover Shrubland  Open Cropland BuiltUp Snow and ice Water Mangroves
   0     81184         0 22729      293      89            1   144         0
   1      8743         0  1693        6       1            0     1         0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping land use groups with too few used steps</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (virtually no variation in case status)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>bobcat_ssf_filtered <span class="ot">&lt;-</span> bobcat_ssf_data <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span>(land_use_grouped <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BuiltUp"</span>, <span class="st">"Snow and ice"</span>, <span class="st">"Water"</span>, <span class="st">"Cropland"</span>)))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit SSF with glmmTMB following Muff et al. (2019)</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>ssf_bobcat <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  case_binary_ <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    land_use_grouped <span class="sc">*</span> (hfp_std <span class="sc">+</span> <span class="fu">I</span>(hfp_std<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    log_sl_ <span class="sc">+</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0</span> <span class="sc">+</span> land_use_grouped <span class="sc">+</span> hfp_std <span class="sc">+</span> <span class="fu">I</span>(hfp_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> log_sl_<span class="sc">||</span> id) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> step_id_),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">doFit =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> bobcat_ssf_filtered,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">map =</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NA</span>))),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">theta =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> <span class="dv">5</span>),<span class="fu">log</span>(<span class="fl">1e3</span>))),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmmTMBControl</span>(<span class="at">parallel =</span> nt)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in finalizeTMB(TMBStruc, obj, fit, h, data.tmb.old): Model convergence
problem; non-positive-definite Hessian matrix. See vignette('troubleshooting')</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in finalizeTMB(TMBStruc, obj, fit, h, data.tmb.old): Model convergence
problem; false convergence (8). See vignette('troubleshooting'),
help('diagnose')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ssf_bobcat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(diag(vcovs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson  ( log )
Formula:          
case_binary_ ~ -1 + land_use_grouped * (hfp_std + I(hfp_std^2)) +  
    log_sl_ + (0 + land_use_grouped + hfp_std + I(hfp_std^2) +  
    log_sl_ || id) + (1 | step_id_)
Data: bobcat_ssf_filtered

      AIC       BIC    logLik -2*log(L)  df.resid 
       NA        NA        NA        NA    114337 

Random effects:

Conditional model:
 Groups   Name                      Variance                     
 id       land_use_groupedTreeCover       0.013219238045356882655
          land_use_groupedOpen            0.226065145559517732821
          hfp_std                         0.020753855645735262009
          I(hfp_std^2)                    0.004506640749211077851
          log_sl_                         0.000000000160353087181
 step_id_ (Intercept)                999999.999999999534338712692
 Std.Dev.              Corr                                                
    0.1149749452939939                                                     
    0.4754630853804717 0.0000000000                                        
    0.1440619854289648 0.0000000000 0.0000000000                           
    0.0671315182996115 0.0000000000 0.0000000000 0.0000000000              
    0.0000126630599454 0.0000000000 0.0000000000 0.0000000000 0.0000000000 
  999.9999999999997726                                                     
Number of obs: 114349, groups:  id, 26; step_id_, 10444

Conditional model:
                                           Estimate        Std. Error  z value
land_use_groupedTreeCover         -10.9769533774590               NaN      NaN
land_use_groupedOpen              -11.3751196336811               NaN      NaN
hfp_std                             0.0403235126003   0.0379662328199  1.06209
I(hfp_std^2)                       -0.0615865734820   0.0238307836011 -2.58433
log_sl_                            -0.0285534772954   0.0083628069420 -3.41434
land_use_groupedOpen:hfp_std       -0.0371044728576   0.0352825642128 -1.05164
land_use_groupedOpen:I(hfp_std^2)  -0.0216425372659   0.0239449911762 -0.90384
                                    Pr(&gt;|z|)    
land_use_groupedTreeCover                NaN    
land_use_groupedOpen                     NaN    
hfp_std                           0.28819535    
I(hfp_std^2)                      0.00975688 ** 
log_sl_                           0.00063936 ***
land_use_groupedOpen:hfp_std      0.29296583    
land_use_groupedOpen:I(hfp_std^2) 0.36607811    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bobcat model does not converge when trying to model random slopes for habitat covariates. </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The model would have to be simplified to a point where it cannot follow the suggested method by Muff et al.</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping land groups with too few usable steps greatly reduces the ecological richness of the model.</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The bobcat data cannot support a full, comparable SSF with interaction between habitat and human footprint.</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Bobcats are excluded from the final SSF analysis.</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. SSF Results Visualization --------------------------------------------</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.1 Predict for average effect plots ------------------------------------</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"data/coyote_ssf_pred.rds"</span>)) {</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  coyote_ssf_pred <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/coyote_ssf_pred.rds"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  coyote_ssf_pred <span class="ot">&lt;-</span> coyote_ssf_data <span class="sc">|&gt;</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(case_binary_ <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="co"># remove ID for population-level prediction</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">id =</span> <span class="cn">NA</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  coy_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ssf_coyote, coyote_ssf_pred, <span class="at">re.form =</span> <span class="cn">NA</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  coyote_ssf_pred<span class="sc">$</span>fit <span class="ot">&lt;-</span> coy_pred<span class="sc">$</span>fit</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  coyote_ssf_pred<span class="sc">$</span>se <span class="ot">&lt;-</span> coy_pred<span class="sc">$</span>se</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  coyote_ssf_pred <span class="ot">&lt;-</span> coyote_ssf_pred <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(coyote_ssf_pred, <span class="st">"data/coyote_ssf_pred.rds"</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.2 Average-effect plot function ----------------------------------------</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>avg_eff_plot_hfp_landuse <span class="ot">&lt;-</span> <span class="cf">function</span>(fittedResponse,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">nsim =</span> <span class="dv">10</span>, <span class="at">k =</span> <span class="dv">10</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">showPeakValue =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">save_path =</span> <span class="cn">NULL</span>,</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">5.5</span>, <span class="at">dpi =</span> <span class="dv">300</span>) {</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  fit_sample_matrix <span class="ot">&lt;-</span> <span class="fu">replicate</span>(nsim, {</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(fittedResponse), <span class="at">mean =</span> fittedResponse<span class="sc">$</span>fit, <span class="at">sd =</span> fittedResponse<span class="sc">$</span>se)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  smooth_list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>nsim, <span class="cf">function</span>(j) {</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    mgcv<span class="sc">::</span><span class="fu">bam</span>(</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>      fit_sample_matrix[, j] <span class="sc">~</span> <span class="fu">s</span>(human_footprint, <span class="at">by =</span> land_use_grouped,</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">bs =</span> <span class="st">"ts"</span>, <span class="at">k =</span> k) <span class="sc">+</span> land_use_grouped,</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">data    =</span> fittedResponse,</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">select  =</span> <span class="cn">TRUE</span>, <span class="at">discrete =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">nthreads =</span> nt</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>      gratia<span class="sc">::</span><span class="fu">smooth_estimates</span>(<span class="at">overall_uncertainty =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>      gratia<span class="sc">::</span><span class="fu">add_confint</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">hfp =</span> human_footprint)</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>  avg_smooth <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(smooth_list) <span class="sc">|&gt;</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(.smooth, .by, land_use_grouped, hfp) <span class="sc">|&gt;</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">est       =</span> <span class="fu">mean</span>(.estimate),</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower_ci  =</span> <span class="fu">mean</span>(.lower_ci),</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper_ci  =</span> <span class="fu">mean</span>(.upper_ci),</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups   =</span> <span class="st">"drop"</span></span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">land_use_grouped =</span> <span class="fu">factor</span>(</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>      land_use_grouped,</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"TreeCover"</span>, <span class="st">"Open"</span>, <span class="st">"Cropland"</span>, <span class="st">"BuiltUp"</span>, <span class="st">"Water"</span>))</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(avg_smooth,</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> hfp, <span class="at">y =</span> est, <span class="at">colour =</span> land_use_grouped, <span class="at">fill =</span> land_use_grouped)) <span class="sc">+</span></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,  <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">colour =</span> <span class="st">"gray70"</span>) <span class="sc">+</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>land_use_grouped, <span class="at">scales =</span> <span class="st">"fixed"</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> landuse_colors) <span class="sc">+</span></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values   =</span> landuse_colors) <span class="sc">+</span></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Human footprint index (0â€“50)"</span>,</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Estimated relative use (log)"</span>,</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"none"</span>)</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (showPeakValue) {</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>    peak_vals <span class="ot">&lt;-</span> avg_smooth <span class="sc">|&gt;</span></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(land_use_grouped) <span class="sc">|&gt;</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(est <span class="sc">==</span> <span class="fu">max</span>(est)) <span class="sc">|&gt;</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="at">each =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">est =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span>, est, <span class="sc">-</span><span class="cn">Inf</span>))</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(</span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> peak_vals,</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> hfp, <span class="at">y =</span> est, <span class="at">group =</span> land_use_grouped, <span class="at">colour =</span> land_use_grouped),</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(save_path))</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(save_path, p, <span class="at">width =</span> width, <span class="at">height =</span> height, <span class="at">dpi =</span> dpi)</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.3 Relative-selection-strength (RSS) function --------------------------</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a>calc_rss_hfp_landuse <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data,</span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">land_use_col =</span> <span class="st">"land_use_grouped"</span>,</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">hfp_col      =</span> <span class="st">"hfp_std"</span>,</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n_points     =</span> <span class="dv">100</span>,</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ci_level     =</span> <span class="fl">0.95</span>,</span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">landuse_cols     =</span> landuse_colors,</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">landuse_cols_sec =</span> landuse_colors,</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">save_path =</span> <span class="cn">NULL</span>,</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="fl">5.5</span>, <span class="at">dpi =</span> <span class="dv">300</span>) {</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a>  rss_df <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(<span class="fu">unique</span>(data[[land_use_col]]), <span class="cf">function</span>(lc) {</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a>    dat_lc  <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(data, <span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(land_use_col) <span class="sc">==</span> lc)</span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a>    hfp_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat_lc[[hfp_col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">max</span>(dat_lc[[hfp_col]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length.out =</span> n_points)</span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a>    newdata <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">hfp_std =</span> hfp_seq, <span class="at">land_use_grouped =</span> lc) <span class="sc">|&gt;</span></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">I(hfp_std^2)</span><span class="st">`</span> <span class="ot">=</span> hfp_std<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">log_sl_        =</span> <span class="fu">mean</span>(data<span class="sc">$</span>log_sl_, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">step_id_ =</span> <span class="cn">NA</span>, <span class="at">id =</span> <span class="cn">NA</span>, <span class="at">case_binary_ =</span> <span class="dv">1</span></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a>    baseline <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(newdata, hfp_std <span class="sc">==</span> <span class="fu">min</span>(hfp_std))</span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>    x1_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, newdata,               <span class="at">re.form =</span> <span class="cn">NA</span>)</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a>    x2_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, baseline[<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(newdata)), ], <span class="at">re.form =</span> <span class="cn">NA</span>)</span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a>    mm_terms <span class="ot">&lt;-</span> <span class="fu">delete.response</span>(<span class="fu">terms</span>(model))</span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a>    X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(mm_terms, newdata)</span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>    X2 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(mm_terms, baseline[<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(newdata)), ])</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a>    delta_X <span class="ot">&lt;-</span> X1 <span class="sc">-</span> X2</span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a>    vc        <span class="ot">&lt;-</span> <span class="fu">vcov</span>(model)<span class="sc">$</span>cond</span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a>    keep_cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(delta_X), <span class="fu">colnames</span>(vc))</span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a>    delta_X   <span class="ot">&lt;-</span> delta_X[, keep_cols, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>    vc        <span class="ot">&lt;-</span> vc[keep_cols, keep_cols, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a>    se_pred <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">rowSums</span>((delta_X <span class="sc">%*%</span> vc) <span class="sc">*</span> delta_X))</span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a>    z_val   <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> ci_level) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>      <span class="at">land_use_grouped =</span> lc,</span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>      <span class="at">hfp_std          =</span> hfp_seq,</span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>      <span class="at">human_footprint  =</span> hfp_seq <span class="sc">*</span> <span class="fu">sd</span>(data<span class="sc">$</span>human_footprint, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>(data<span class="sc">$</span>human_footprint, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">logRSS    =</span> x1_pred <span class="sc">-</span> x2_pred,</span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a>      <span class="at">RSS       =</span> <span class="fu">exp</span>(logRSS),</span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>      <span class="at">RSS_lower =</span> <span class="fu">exp</span>(logRSS <span class="sc">-</span> z_val <span class="sc">*</span> se_pred),</span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a>      <span class="at">RSS_upper =</span> <span class="fu">exp</span>(logRSS <span class="sc">+</span> z_val <span class="sc">*</span> se_pred)</span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rss_df,</span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> human_footprint, <span class="at">y =</span> RSS,</span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a>                  <span class="at">colour =</span> land_use_grouped, <span class="at">fill =</span> land_use_grouped)) <span class="sc">+</span></span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> RSS_lower, <span class="at">ymax =</span> RSS_upper),</span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> landuse_cols) <span class="sc">+</span></span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values  =</span> landuse_cols_sec) <span class="sc">+</span></span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Human footprint index (0â€“50)"</span>,</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Relative selection strength (RSS)"</span>,</span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a>      <span class="at">colour =</span> <span class="st">"Land cover type"</span>, <span class="at">fill =</span> <span class="st">"Land cover type"</span></span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_publication_dark</span>(<span class="at">legend_position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(save_path))</span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(save_path, p, <span class="at">width =</span> width, <span class="at">height =</span> height, <span class="at">dpi =</span> dpi)</span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.4 Generate and plot average effect ------------------------------------</span></span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a>p_avg_effect <span class="ot">&lt;-</span> <span class="fu">avg_eff_plot_hfp_landuse</span>(coyote_ssf_pred, <span class="at">nsim =</span> <span class="dv">1000</span>, <span class="at">save_path =</span> <span class="st">"img/avg_effect.png"</span>)</span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_avg_effect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Report peaks</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>p_avg_effect<span class="sc">$</span>plot_env<span class="sc">$</span>peak_vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 7
# Groups:   land_use_grouped [5]
   .smooth               .by   land_use_grouped    hfp     est lower_ci upper_ci
   &lt;chr&gt;                 &lt;chr&gt; &lt;fct&gt;             &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 s(human_footprint):lâ€¦ landâ€¦ TreeCover        10.1      2.15    1.96      2.34
 2 s(human_footprint):lâ€¦ landâ€¦ TreeCover        10.1   -Inf       1.96      2.34
 3 s(human_footprint):lâ€¦ landâ€¦ Open              8.99     2.36    2.18      2.54
 4 s(human_footprint):lâ€¦ landâ€¦ Open              8.99  -Inf       2.18      2.54
 5 s(human_footprint):lâ€¦ landâ€¦ Cropland          5.91     2.30    1.94      2.67
 6 s(human_footprint):lâ€¦ landâ€¦ Cropland          5.91  -Inf       1.94      2.67
 7 s(human_footprint):lâ€¦ landâ€¦ BuiltUp           0.131    3.29    0.288     6.29
 8 s(human_footprint):lâ€¦ landâ€¦ BuiltUp           0.131 -Inf       0.288     6.29
 9 s(human_footprint):lâ€¦ landâ€¦ Water             0.131    2.79    1.82      3.77
10 s(human_footprint):lâ€¦ landâ€¦ Water             0.131 -Inf       1.82      3.77</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.5 Generate and plot RSS -----------------------------------------------</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>p_rss <span class="ot">&lt;-</span> <span class="fu">calc_rss_hfp_landuse</span>(ssf_coyote, coyote_ssf_data, <span class="at">save_path =</span> <span class="st">"img/rss.png"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_rss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="preprocessing_SSF_complete_files/figure-html/unnamed-chunk-1-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>